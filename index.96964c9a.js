var t={};class e{static STATUSES={IDLE:"idle",PLAYING:"playing",WIN:"win",LOSE:"lose"};status=e.STATUSES.IDLE;score=0;constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){if(4!==t.length)throw Error("InitialState should have 4 rows.");this.state=[];for(let e=0;e<t.length;e++){if(4!==t[e].length)throw Error("InitialState should have 4 columns.");this.state.push([...t[e]])}}isStateEqualTo(t){for(let e=0;e<this.state.length;e++)for(let s=0;s<this.state[e].length;s++)if(this.state[e][s]!==t[e][s])return!1;return!0}addNewValue(t){if(!this.isStateEqualTo(t)){let t=this.getRandomField();this.state[t[0]][t[1]]=this.getRandomNumber()}}moveLeft(){let t=this.state.map(t=>t.slice());for(let t=0;t<this.state.length;t++){let e=()=>{for(let e=0;e<3;e++)for(let e=0;e<this.state[t].length-1;e++)0===this.state[t][e]&&0!==this.state[t][e+1]&&(this.state[t][e]=this.state[t][e+1],this.state[t][e+1]=0)},s=()=>{for(let e=0;e<this.state[t].length-1;e++)this.state[t][e]===this.state[t][e+1]&&0!==this.state[t][e]&&0!==this.state[t][e+1]&&(this.state[t][e]=this.state[t][e]+this.state[t][e+1],this.score+=this.state[t][e],this.state[t][e+1]=0,e++)};e(),s(),e()}this.addNewValue(t),this.changeStatusIfGameOver()}moveRight(){let t=this.state.map(t=>t.slice());for(let t=0;t<this.state.length;t++){let e=()=>{for(let e=0;e<3;e++)for(let e=1;e<this.state[t].length;e++)0===this.state[t][e]&&0!==this.state[t][e-1]&&(this.state[t][e]=this.state[t][e-1],this.state[t][e-1]=0)},s=()=>{for(let e=1;e<this.state[t].length;e++)this.state[t][e]===this.state[t][e-1]&&0!==this.state[t][e]&&0!==this.state[t][e-1]&&(this.state[t][e]=this.state[t][e]+this.state[t][e-1],this.score+=this.state[t][e],this.state[t][e-1]=0,e++)};e(),s(),e()}this.addNewValue(t),this.changeStatusIfGameOver()}moveUp(){let t=this.state.map(t=>t.slice());for(let t=0;t<this.state.length;t++){let e=()=>{for(let e=0;e<3;e++)for(let e=0;e<this.state[t].length-1;e++)0===this.state[e][t]&&0!==this.state[e+1][t]&&(this.state[e][t]=this.state[e+1][t],this.score+=this.state[t][e],this.state[e+1][t]=0)},s=()=>{for(let e=0;e<this.state[t].length-1;e++)this.state[e][t]===this.state[e+1][t]&&0!==this.state[e][t]&&0!==this.state[e+1][t]&&(this.state[e][t]=this.state[e][t]+this.state[e+1][t],this.score+=this.state[t][e],this.state[e+1][t]=0,e++)};e(),s(),e()}this.addNewValue(t),this.changeStatusIfGameOver()}moveDown(){let t=this.state.map(t=>t.slice());for(let t=0;t<this.state.length;t++){let e=()=>{for(let e=0;e<3;e++)for(let e=1;e<this.state[t].length;e++)0===this.state[e][t]&&0!==this.state[e-1][t]&&(this.state[e][t]=this.state[e-1][t],this.state[e-1][t]=0)},s=()=>{for(let e=1;e<this.state[t].length;e++)this.state[e][t]===this.state[e-1][t]&&0!==this.state[e][t]&&0!==this.state[e-1][t]&&(this.state[e][t]=this.state[e][t]+this.state[e-1][t],this.score+=this.state[e][t],this.state[e-1][t]=0,e++)};e(),s(),e()}this.addNewValue(t),this.changeStatusIfGameOver()}changeStatusIfGameOver(){if(this.isWin()){this.status=e.STATUSES.WIN;return}this.isGameOver()&&(this.status=e.STATUSES.LOSE)}isGameOver(){for(let t=0;t<this.state.length;t++)for(let e=0;e<this.state[t].length;e++)if(0===this.state[t][e])return!1;for(let t=0;t<this.state.length;t++)for(let e=0;e<this.state[t].length;e++)if(e<this.state.length-1&&this.state[t][e]===this.state[t][e+1]||t<this.state.length-1&&this.state[t][e]===this.state[t+1][e])return!1;return!0}isWin(){for(let t=0;t<this.state.length;t++)for(let e=0;e<this.state[t].length;e++)if(2048===this.state[t][e])return!0;return!1}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){if(this.status===e.STATUSES.IDLE){this.score=0,this.status=e.STATUSES.PLAYING;let t=this.getRandomField();this.state[t[0]][t[1]]=this.getRandomNumber()}}restart(){this.state=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.status!==e.STATUSES.IDLE&&(this.status=e.STATUSES.IDLE,this.start())}getRandomNumber(){return .1>Math.random()?4:2}getRandomField(){let t=[];return this.state.forEach((e,s)=>{e.forEach((e,a)=>{0===e&&t.push([s,a])})}),t[Math.floor(Math.random()*(t.length-1+1))]}}const s=new(t=e),a=document.querySelector(".game-score"),i=document.querySelector(".button"),h=document.querySelectorAll(".game-field .field-row"),r=document.querySelector(".message-start"),l=document.querySelector(".message-win"),o=document.querySelector(".message-lose"),n=[...h].map(t=>t.querySelectorAll(".field-cell"));function c(){n.forEach(t=>{t.forEach(t=>{t.textContent="",t.className="field-cell"})})}function d(){n.forEach((t,e)=>{t.forEach((t,a)=>{let i=s.getState()[e][a];0!==i&&(t.textContent=i,t.classList.add(`field-cell--${i}`))})})}i.addEventListener("click",()=>{s.getStatus()===t.STATUSES.IDLE?(s.start(),i.textContent="Restart"):(c(),a.textContent=0,s.restart()),i.classList.contains("start")&&(i.classList.remove("start"),i.classList.add("restart")),r.classList.contains("hidden")||r.classList.add("hidden"),l.classList.contains("hidden")||l.classList.add("hidden"),o.classList.contains("hidden")||o.classList.add("hidden"),d()}),document.addEventListener("keydown",e=>{s.getStatus()===t.STATUSES.PLAYING&&("ArrowLeft"===e.key?s.moveLeft():"ArrowRight"===e.key?s.moveRight():"ArrowUp"===e.key?s.moveUp():"ArrowDown"===e.key&&s.moveDown(),["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(event.key)&&(c(),d(),a.textContent=s.getScore())),s.getStatus()===t.STATUSES.WIN&&l.classList.remove("hidden"),s.getStatus()===t.STATUSES.LOSE&&o.classList.remove("hidden")});
//# sourceMappingURL=index.96964c9a.js.map
